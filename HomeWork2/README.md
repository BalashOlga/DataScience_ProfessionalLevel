# U-Net автоэнкодер для сегментации медицинских изображений

## Описание проекта

Проект посвящен разработке автоэнкодера с архитектурой U-Net для точной сегментации медицинских изображений, в частности МРТ-снимков мозга. 
Модель обучается выделять области опухолей на медицинских изображениях.

## Источники данных и кода

### Архитектура модели
- Модель U-Net взята из открытого репозитория [milesial/Pytorch-UNet](https://github.com/milesial/Pytorch-UNET)
- Использована папка `unet` с реализацией архитектуры

### Данные
- Данные для обучения взяты с Kaggle (https://www.kaggle.com/datasets/mateuszbuda/lgg-mri-segmentation)
- Набор данных содержит МРТ-снимки мозга с соответствующими масками сегментации
- Размер датасета: 3929 примеров 
- Формат: изображения + бинарные маски
Все изображения представлены в формате .tif с 3 каналами на изображение.
Для 101 случая доступны 3 последовательности: до контрастирования, FLAIR, после контрастирования (в таком порядке каналов).
Маски являются бинарными одноканальными изображениями. Они сегментируют аномалию FLAIR, присутствующую в последовательности FLAIR (доступна для всех случаев).
- Папка `examples` содержит 2 примера для демонстрации формата данных. Примеры используются в образовательных целях. Полный датасет необходимо скачать с оригинального источника

## Модель и обучение

### Характеристики модели
- **Архитектура**: U-Net
- **Количество параметров**: 31,036,481
- **Входные данные**: МРТ-снимки мозга
- **Выходные данные**: Маски сегментации опухолей

### Особенности реализации
Для упрощения вычислений  использован только один слой (FLAIR).

### Гиперпараметры обучения
- **Learning rate**: 1e-05
- **Weight decay**: 1e-05
- **Batch size**: 16
- **Pos weight**: 10.0 (для балансировки классов)
- **Max epochs**: 100
- **Early stopping patience**: 10
- **Target loss**: 0.08

### Процесс обучения

**Обучение на CPU:**
- Время на эпоху: ~1 час 40 минут
- Использовалось для первоначальной отладки

```bash
python medical_unet_cpu.py
```

**Обучение на GPU (Google Colab):**
- Время на эпоху: ~3 минуты
- Использовалось для финального обучения

```bash
python medical_unet_colab_gpu.py
```

## Результаты обучения

### Лучшая модель
- **Эпоха**: 35
- **Loss**: 0.0774
- **Время обучения**: 6543.4 секунды (109.1 минут)
- **Дата достижения**: 2025-11-09 12:01:05

### Прогресс обучения
Модель демонстрировала стабильное улучшение качества:
- Начальный loss: 0.8760
- Быстрое снижение в первых эпохах
- Плавное улучшение до целевого значения
- Ранняя остановка сработала при достижении loss ≤ 0.08

## Тестирование модели
```bash
python test_model.py
```

Для тестирования обученной модели используется скрипт `test_model.py`, который:
- Загружает сохраненную модель (папка `models`, обученная модель на загружалась ввиду большого размера файла)
- Тестирует на тех же данных, что использовались для обучения
- Генерирует сравнительные изображения в папке `results`
- Визуализирует исходные изображения, предсказанные маски и истинные маски

## Заключение
Проект успешно реализовал U-Net автоэнкодер для сегментации медицинских изображений.
Модель достигла хороших результатов с loss 0.0774 за 35 эпох обучения. 
Использование GPU значительно ускорило процесс обучения. 
Модель способна cегментировать области опухолей на МРТ-снимках мозга, что подтверждается визуальными результатами в папке `results`